
\section{Метрики}
\label{sec:metrics}

Данный раздел посвящен выявлению особенностей и численному сравнению алгоритмов. В последующих разделах везде подразумеваются следующие обозначения:

\begin{itemize}
    \item $R_k$ - поиск, реализующий алгоритм \textit{BM25} \cite{robertson2009probabilistic}
    \item $R_e$ - поиск ближайшего соседа (ANN), использующий реализацию \textit{Weavaite} \cite{weaviate} алгоритмом \textit{HNSW} \url{enwiki:hsnw}
    \item $R_h$ - гибридный поиск, совмещающий первых два подхода, с наилучшим выбранным порогом $\theta$.
    \item $R_{\gamma}$ - поиск ближайшего соседа (ANN), используюший ранжирование $f(\gamma_1, \gamma_2)$ \eqref{eq:gamma-func}
\end{itemize}


\subsection{Выбор ключевых слов}
\label{sec:keywords-vs-content}

Для функции ранжирования, вполне мог бы подойти и сам текст параграфа. Действительно, код и оставшаяся часть алгоритма никак бы не изменились. 
Однако выбор самого текста параграфа влечет за собой некоторые изъяны, и как показано на графике ниже, аномальные всплески сильно ``ухудшают'' общую метрику, 
приоритезируя выдачу по ключевым словам. Так, например, для набора данных $D_u$ показано сравнения $\phi_r$ на контексте документа и его ключевых словах:

% \begin{figure}[ht]
%     \centering
%     \includegraphics[width=\columnwidth]{figures/idf-recall-content-vs-keywords.png} % Используем ширину одной колонки
%     \caption{Comparison of $\phi_r$ using $D_u$ dataset}
%     \label{fig:comparison-phir-content-vs-keywords}
% \end{figure}


\subsection{Результаты}
\label{sec:final-metrics}

Ниже, приведены основные результаты сравнения, подтверждающие гипотезу о том, что гибридный поиск $R_h$(с наилучшим коэффициентом $\theta$) 
показывает результаты хуже, чем предложенный в статье алгоритм - $R_{\gamma}$, основанный на дополнительном ранжировании, выбирающий $top_p$ и дополнительно 
ранжирующий результаты через $\gamma_1, \gamma_2$.

В таблицах ~\ref{tab:hitrate-small} ~\ref{tab:hitrate-base} ~\ref{tab:hitrate-large} представлены результаты сравнения на выборке данных из $D_u$, $D_v$ для моделей семейства \textit{E5} \cite{e5} размеров \textit{$E5_{small}$}, \textit{$E5_{ base}$} и \textit{$E5_{large}$} соответственно.
\input{tables/hitrate-small.tex}
\input{tables/hitrate-base.tex}
\input{tables/hitrate-large.tex}

\noindent
\textbf{Universe Question ($D_u$)}~\cite{repojustatom} - вопросы и параграфы, основанные на вселенных из книг, игр, фильмов или сериалов.
Набор данных был составлен экспертами, которые были погружены в эти вселенные. Помимо уникальной лингвистической структуры, речевыми оборотами, 
этот датасет предсталяет особую трудность для адаптации из-за сложности в токенизации имен собственных, заклинаний и лексическим сдвигом от формального повествования. 
Так, например, в таких произведениях как 
\href{https://en.wikipedia.org/wiki/Harry_Potter}{Harry Potter}, 
\href{https://en.wikipedia.org/wiki/The_Witcher}{The Witcher}, 
\href{https://en.wikipedia.org/wiki/The_Hunger_Games}{The Hunger Games} и других 
существует существенный сдвиг в сторону фэнтезийных терминов, которые токенизируются буквально по слогам, что приводит к ``сдвинутому распределению''. В таблице 
~\ref{tab:queries_DU} приведены примеры вопросов.
\input{tables/queries-DU.tex}

\noindent
\textbf{Vanilla factoid Question ($D_v$)}~\cite{repojustatom} - состоит из вопросов и соответствующих к ним параграфов, которые, преимущественно, относятся к биологии, истории и другим общим фактам.
Этот набор данных был проверен экспертами. Помимо проверки корректности вопроса и релевантности параграфа, вопросы заданы в разных стилях. В данном наборе нет проблемы токенизации, 
т.к. преимущественно он состоит из общеизственых фактов, и, лишь иногда, встречаются научные термины, которые могут токенизироваться по-слогам. В таблице 
~\ref{tab:queries_DV} представлены примеры.
\input{tables/queries-DV.tex}

Вышеописанные примеры показывают разницу в вопросах, но, как было показано ранее в \ref{fig:clustering-e5-base}, \ref{fig:clustering-e5-base-universe}, сами параграфы, в свою очередь, 
представлены разными стилями, длиной предложений, морфологическими особенностями языка и другими характеристами. 

